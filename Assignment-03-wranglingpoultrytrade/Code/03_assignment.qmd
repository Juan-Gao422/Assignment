---
title: "Assignment 3"
format:
  html:
    code-fold: false
    embed-resources: true
    toc: true
---

# Dataset Description: U.S. Bilateral Trade in Poultry Products  

This dataset contains bilateral international trade data for the United States as the reporter country, focusing on the commodity classified under "**meat and edible offal**" of poultry, traded in fresh, chilled, or frozen form.  

The dataset includes poultry products, covering common cuts and parts such as breasts, thighs, wings, livers, hearts, and gizzards. It excludes live poultry and processed poultry products.  

Trade flows are reported with all countries as partners, meaning the data capture U.S. poultry trade with every trading partner (countries) worldwide. The dataset includes:  

-   Imports: Poultry products entering the United States from foreign suppliers (e.g., frozen chicken from Brazil or Canada).  

-   Exports: Poultry products shipped from the United States to international markets (e.g., U.S. poultry exports to Mexico or Asian countries).  

The data are aggregated at an annual frequency and cover the period 2018–2025.  

# Data Source:  

The dataset is obtained from the UN Comtrade database, an open-access repository of official international trade statistics compiled from customs data reported by over 150 countries. Key variables include trade values (USD) and quantities (kilograms), reflecting officially reported bilateral trade flows between the United States and its trading partners.  

# General directions  

1.  For each question, you are encouraged to create a chunk below it, and fully develop the code that creates your answer.  

2.  You are encouraged to use wrangling functions from the packages `dplyr` and `tidyr`, and plotting functions from the package `ggplot2`.  

3.  You are encouraged to the the pipe operator (`%>%` or `|>`) to pipe wrangling steps together.  

4.  For each question, after showing your code and output (be it numerical or graphical), you also need to provide a written sentence of your answer. Just showing code output is not sufficient for full points.  

5.  As part of the initial wrangling, you are expected to:  

-   Transform the `qty` column from kg to Mg  
-   Select only columns that are useful to answer the questions.  

6. Check out the following cheatsheets to give you some ideas on wrangling and plotting:  

  - **ggplot2**: https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf  
  - **dplyr**: https://rstudio.github.io/cheatsheets/data-transformation.pdf   
  


## Dataset

```{r}

library(dplyr)
library(tidyr)
library(ggplot2)

PoultryData <- read.csv("../Data/03_assignment_data.csv")
# glimpse(PoultryData)
# colnames(PoultryData)
# identical(PoultryData$qty, PoultryData$net_wgt)

PoultryDataClean <- PoultryData %>% 
  mutate(
    qty_mg = qty/1000
    ) %>%
  dplyr::select(
    ref_year,
    flow_desc, 
    partner_desc, 
    primary_value, 
    qty_mg
    ) %>%
  arrange(
    flow_desc
    )

PoultryDataClean
```

# Assignemnt Questions:

## Imports:

#### 1. How many distinct countries were there (based on given data), from where US was importing the poultry products from 2018-2024?

```{r}
PoultryDataClean_Import <- filter(PoultryDataClean,
                              flow_desc == "Import",
                              ref_year >= 2018,
                              ref_year <= 2024
                                  )

PoultryDataClean_Import

PoultryDataClean_Import_CountryNum <- n_distinct(PoultryDataClean_Import$partner_desc)

PoultryDataClean_Import_CountryNum

```

Based on given data, from 2018-2024, US imported poultry products from seven distinct countries. 

#### 2. What are the minimum, maximum trade values for imports? Mention the country, year and its respective value.

```{r}

Tradevalues_Import <- PoultryDataClean_Import %>%
  dplyr::select(
                partner_desc,
                ref_year,
                primary_value
                )

Tradevalues_Import

Tradevalues_Import_min <- arrange(
                                  Tradevalues_Import,
                                  primary_value
                                  ) %>%
  slice(1)

Tradevalues_Import_min

Tradevalues_Import_max <- arrange(
                                  Tradevalues_Import, 
                                  desc(primary_value)
                                  ) %>%
  slice(1)

Tradevalues_Import_max

```

The minimum trade value for imports was \$4308 from Poland in 2022.
The maximum trade value for imports was \$428214676 from Chile in 2022.

#### 3. Identify the top 5 countries from which the USA imported the most (qty) in the years 2018 and 2024. List the countries and their corresponding import values.

```{r}

TopfiveCountry_Import_2018 <- PoultryDataClean_Import %>%
  filter(ref_year == 2018) %>%
  group_by(partner_desc) %>%
  summarise(
    qty = sum(qty_mg),
    tradevalue = sum(primary_value)) %>%
  arrange(desc(qty)) %>%
  slice(1:5)

TopfiveCountry_Import_2018
  
TopfiveCountry_Import_2024 <- PoultryDataClean_Import %>%
  filter(ref_year == 2024) %>%
  group_by(partner_desc) %>%
  summarise(
    qty = sum(qty_mg),
    tradevalue = sum(primary_value)) %>%
  arrange(desc(qty)) %>%
  slice(1:5)

TopfiveCountry_Import_2024

```

The results are based on my understanding of this question. I understood "in the years 2018 and 2024" to mean that the top five country should be identified separately for 2018 and 2024, which is also more meaningful to compare. In addition, “import values” was interpreted as the primary trade value (primaryValue), rather than the values of physical quantity (qty).

Based on the interpretation above:

In 2018, the U.S. imported poultry products from only four countries. These were Chile (\$139,757,883), Canada (\$117,042,640), Israel (\$8,305,053), and Germany (\$206,221).

In 2024, the U.S. imported poultry products from only three countries. These were Chile (\$222,025,539), Canada (\$146,943,943), and Mexico (\$267,323).


#### 4. Calculate the total import value for the USA from each country. Which country had the highest total export value **to** US, and what was that value?

```{r}

TotalImportValue_Country <- PoultryDataClean_Import %>%
  dplyr::select(partner_desc,
                primary_value
                ) %>%
  group_by(partner_desc) %>%
  summarise(Total_import_tradevalue = sum(primary_value)) %>%
  arrange(desc(Total_import_tradevalue))

TotalImportValue_Country

```

The results are based on my understanding of this question. The “import value” was interpreted as the primary trade value (primaryValue). The question was asking years from 2018 to 2024.

Chile had the highest total export value (\$1532686723) to US.


#### 5. Calculate the total import value for the USA in each year from 2018 to 2025. Which year had the highest total import value, and what was that value?

```{r}

TotalImportValue_Yearly <- PoultryDataClean_Import %>%
  dplyr::select(ref_year,
                primary_value
                ) %>%
  group_by(ref_year) %>%
  summarise(Total_import_tradevalue = sum(primary_value)) %>%
  arrange(desc(Total_import_tradevalue))

TotalImportValue_Yearly

```

Based on the provided dataset, the available data cover the years 2018 to 2024 only.

The highest total import value (\$566412591) occurred in 2022.

#### 6. Plot a line graph showing the total annual import value for the USA from 2018 to 2024. Describe any noticeable trends or patterns (e.g., increases, decreases, or fluctuations) in the graph. Create a publication ready plot.

```{r}

TotalImportValue_Yearly_1 <- mutate(TotalImportValue_Yearly,
                                    Total_import_tradevalue_million = Total_import_tradevalue/1000000)

TotalImportValue_Yearly_1

ggplot(data = TotalImportValue_Yearly_1,
       aes(x = ref_year,
           y = Total_import_tradevalue_million)
       ) + 
  geom_line(color = "black",
                 linewidth = 1.5) +
  geom_point(color = "black",
             size = 3,
             shape = 15) +
  labs(x = "Year",
       y = "Total Annual Import Value (Million USD)",
       title = "Total Annual U.S. Poultry Import Value (2018–2024)") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
        axis.title = element_text(size = 14, face = "bold"),
        axis.text = element_text(size = 12),
        panel.border = element_rect(color = "black", fill = NA, linewidth = 1)
        )

```
As shown in this figure, the total annual import value for the U.S. decreased from 2018 to 2019, and then increased steadily until 2022. After that, there was a sharp decrease in 2023, followed by a gradual increase in 2024.


## Exports:

#### 7. How many distinct countries were there (based on given data), to where US was exporting the poultry products?

```{r}

PoultryDataClean_Export <- filter(PoultryDataClean,
                              flow_desc == "Export",
                              ref_year >= 2018,
                              ref_year <= 2024
                                  )

PoultryDataClean_Export

PoultryDataClean_Export_CountryNum <- n_distinct(PoultryDataClean_Export$partner_desc)

PoultryDataClean_Export_CountryNum

```

Based on given data, from 2018-2024, US exported poultry products to 188 distinct countries. 


#### 8. What are the minimum, maximum trade values for exports? Mention the country, year and its respective value.

```{r}

Tradevalues_Export <- PoultryDataClean_Export %>%
  dplyr::select(
                partner_desc,
                ref_year,
                primary_value
                )

Tradevalues_Export

Tradevalues_Export_min <- arrange(
                                  Tradevalues_Export,
                                  primary_value
                                  ) %>%
  slice(1)

Tradevalues_Export_min

Tradevalues_Export_max <- arrange(
                                  Tradevalues_Export, 
                                  desc(primary_value)
                                  ) %>%
  slice(1)

Tradevalues_Export_max

```
The minimum trade value for exports was \$2900 to Czechia in 2018.
The maximum trade value for exports was \$1172550687 to Mexico in 2024.


#### 9. Identify the top 5 countries to which the USA exported the most (qty) in the years 2018 and 2024. List the countries and their corresponding export values.

```{r}

TopfiveCountry_Export_2018 <- PoultryDataClean_Export %>%
  filter(ref_year == 2018) %>%
  group_by(partner_desc) %>%
  summarise(
    qty = sum(qty_mg),
    tradevalue = sum(primary_value)) %>%
  arrange(desc(qty)) %>%
  slice(1:5)

TopfiveCountry_Export_2018
  
TopfiveCountry_Export_2024 <- PoultryDataClean_Export %>%
  filter(ref_year == 2024) %>%
  group_by(partner_desc) %>%
  summarise(
    qty = sum(qty_mg),
    tradevalue = sum(primary_value)) %>%
  arrange(desc(qty)) %>%
  slice(1:5)

TopfiveCountry_Export_2024

```
The results are based on my understanding of this question. I understood "in the years 2018 and 2024" to mean that the top five country should be identified separately for 2018 and 2024, which is also more meaningful to compare. In addition, “import values” was interpreted as the primary trade value (primaryValue), rather than the values of physical quantity (qty).

Based on the interpretation above:

In 2018, the top five countries to which the USA exported the most are Mexico (\$763541266), China, Hong Kong SAR (\$412669749), Angola (\$183671360), Other Asia, nes	(\$188024792), and Cuba (\$154537803).

In 2024, the top five countries to which the USA exported the most are Mexico (\$1172550687), Cuba (\$298231173), Other Asia, nes	(\$261812562), Philippines (\$187724475), and Canada (\$403487221).


#### 10. Calculate the total export value for the USA from each country. Which country had the highest total import value **from** US, and what was that value?

```{r}

TotalExportValue_Country <- PoultryDataClean_Export %>%
  dplyr::select(partner_desc,
                primary_value
                ) %>%
  group_by(partner_desc) %>%
  summarise(Total_export_tradevalue = sum(primary_value)) %>%
  arrange(desc(Total_export_tradevalue))

TotalExportValue_Country


```

The results are based on my understanding of this question. The “export value” was interpreted as the primary trade value (primaryValue). The question was asking years from 2018 to 2024.

Mexico had the highest total import value (\$6823047519) from US.

#### 11. Calculate the total export value for the USA in each year from 2018 to 2025. Which year had the highest total export value, and what was that value?

```{r}

TotalExportValue_Yearly <- PoultryDataClean_Export %>%
  dplyr::select(ref_year,
                primary_value
                ) %>%
  group_by(ref_year) %>%
  summarise(Total_export_tradevalue = sum(primary_value)) %>%
  arrange(desc(Total_export_tradevalue))

TotalExportValue_Yearly

```

Based on the provided dataset, the available data cover the years 2018 to 2024 only.

The highest total export value (\$5401343250) occurred in 2022.

#### 12. Plot a line graph showing the total annual export value for the USA from 2018 to 2024. Describe any noticeable trends or patterns (e.g., increases, decreases, or fluctuations) in the graph. Create a publication ready plot.

```{r}

TotalExportValue_Yearly_1 <- mutate(TotalExportValue_Yearly,
                                    Total_export_tradevalue_million = Total_export_tradevalue/1000000)

TotalExportValue_Yearly_1

ggplot(data = TotalExportValue_Yearly_1,
       aes(x = ref_year,
           y = Total_export_tradevalue_million)
       ) + 
  geom_line(color = "black",
                 linewidth = 1.5) +
  geom_point(color = "black",
             size = 3) +
  labs(x = "Year",
       y = "Total Annual Export Value (Million USD)",
       title = "Total Annual U.S. Poultry Export Value (2018–2024)") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
        axis.title = element_text(size = 14, face = "bold"),
        axis.text = element_text(size = 12),
        panel.border = element_rect(color = "black", fill = NA, linewidth = 1)
        )

```
As shown in this figure, the total annual export value for the U.S. increased gradually from 2018 to 2020, followed by a sharp increase until 2022. After 2022, the export value decreased sharply in 2023 and then declined slightly in 2024.


## Imports - Exports Comparision:

#### 13. Does the U.S. behave more as a net importer or net exporter for this commodity? Explore it:

-   Based on total value US imports and exports.
-   Based on number of countries US imports and exports
-   Based on each year's import export value.

#### 14. Are the main import partners also major export destinations? Explore it based on the total import export value by countries.

#### 15. Can you calculate if US is in trade surplus or trade deficit for each year from 2018-2024?

$$\text{Trade surplus or deficit} = \text{Imports} - \text{Exports}$$

# Submitting your work  

Once you have developed all the code and answers, make sure to Render this quarto file.  

**Notes on rendering**:  

- Make sure to render your work and inspect how the final html look like.  
- If it does not look professional for whatever reason, then fix the issue, re-render it, recheck.  
- Only send me your work once your html file looks professional.  
- Some potential issues you may encounter and how to fix them:   
  - Some times your code may be creating a table output that is waaay to long and cumbersome to scroll through when rendered. If this is the case, make it more professional looking by using the `head()` function to only print the first handful of rows (instead of thousands of rows).  
  
  - **DO NOT** delete the file's heading levels (# and ##). They set up the proper heading 1 and 2 levels, and I use them to guide my grading.  
  
  - There's a total of **15 questions**. If you mess around with the heading levels and you get a different number of questions on the rendered version, fix it.  
  
  - If a given chunk is also outputting warnings or messages, inhibit this behavior by changing the chunk options `message` and `warning` to `FALSE` (I'll demo this in a moment).  
  
  - If, after rendered, 2 lines of text are connected and you wish to "break line" between them, add 2 extra spaces after the first one (I'lld demo this in a moment).    
  
After rendering, an .html file will be created on your `code` folder.  

Rename this file to `03_assignment_LASTNAME.html`.    

For ex., `03_assignment_Bastos.html`.

Submit the html file on eLC by Monday Feb 2nd 11:59 pm, **one week** from today.  

